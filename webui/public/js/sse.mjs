export function connectRetry(url,{onstate,onopen,onmessage,onerror,onreconnect,min=1000,max=60000}={}){let es=null;let backoff=min||1000;function open(){onstate&&onstate("connecting");es=new EventSource(url);es.onopen=()=>{backoff=min||1000;onstate&&onstate("open");onopen&&onopen()};es.onmessage=e=>{let d=e.data;try{d=JSON.parse(e.data)}catch{};onmessage&&onmessage(d,e)};es.onerror=e=>{try{es.close()}catch{};onstate&&onstate("error");onerror&&onerror(e);const wait=Math.min(max||60000,Math.floor(backoff*(1.5+Math.random()*0.5)));onreconnect&&onreconnect(wait);backoff=wait;setTimeout(open,wait)}}open();return()=>{try{es?.close()}catch{}}}