import json, yaml, pathlib
from jsonschema import validate

ROOT = pathlib.Path(__file__).resolve().parents[2]
with open(ROOT/"contracts/skills.v1.json", "r", encoding="utf-8") as f:
    skills_schema = json.load(f)

def iter_skill_files():
    for d in ["skills/staged", "skills/approved"]:
        p = ROOT / d
        if p.exists():
            for y in p.glob("*.yaml"):
                yield y

def test_skill_yaml_against_schema():
    for yfile in iter_skill_files():
        data = yaml.safe_load(yfile.read_text(encoding="utf-8"))
        validate(instance=data, schema=skills_schema)
