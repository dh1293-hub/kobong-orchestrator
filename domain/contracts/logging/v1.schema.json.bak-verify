{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.local/contracts/logging/v1.schema.json",
  "title": "Conductor Log Event v1",
  "type": "object",
  "required": ["timestamp","tz","level","app","env","host","pid","thread","trace_id",
               "action","result","latency_ms","message"],
  "additionalProperties": true,
  "properties": {
    "timestamp": {"type":"string","format":"date-time"},
    "monotonic_ms": {"type":"number"},
    "tz": {"type":"string","enum":["Asia/Seoul"]},
    "level": {"type":"string","enum":["TRACE","DEBUG","INFO","WARN","ERROR","FATAL"]},
    "app": {
      "type":"object",
      "required":["name","ver"],
      "properties":{
        "name":{"type":"string"},
        "ver":{"type":"string"},
        "commit":{"type":["string","null"]}
      }
    },
    "env":{"type":"string","enum":["dev","stg","prod"]},
    "host":{"type":"string"},
    "pid":{"type":"integer"},
    "thread":{"type":"string"},
    "trace_id":{"type":"string"},
    "span_id":{"type":["string","null"]},
    "user":{"type":["string","null"]},
    "role":{
      "type":"object",
      "required":["card","group"],
      "properties":{"card":{"type":["string","null"]},"group":{"type":["string","null"]}}
    },
    "action":{
      "type":"object",
      "required":["step"],
      "properties":{"step":{"type":"integer"},"dsl_id":{"type":["string","null"]}}
    },
    "result":{
      "type":"object",
      "required":["status","code"],
      "properties":{
        "status":{"type":"string","enum":["ok","retry","timeout","assert_fail","cancel","fatal"]},
        "code":{"type":"integer","enum":[0,1,2,3,4,9]}
      }
    },
    "latency_ms":{"type":"number","minimum":0},
    "message":{"type":"string"},
    "err":{
      "type":"object",
      "properties":{"type":{"type":"string"},"msg":{"type":"string"},"stack":{"type":"string"}},
      "additionalProperties": false
    },
    "snapshot_paths":{"type":"array","items":{"type":"string"}},
    "ocr_text_hash":{"type":["string","null"]},
    "template_match":{
      "type":"object",
      "properties":{"score":{"type":"number"},"method":{"type":"string"}},
      "additionalProperties": false
    }
  }
}
