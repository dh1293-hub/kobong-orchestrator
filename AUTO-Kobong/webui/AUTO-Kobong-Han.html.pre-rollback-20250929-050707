<!doctype html>


<html lang="ko">
<head>


<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>AUTO‑KOBONG Monitor · Han</title>
<link rel="stylesheet" href="assets/list.css">
<style>
  :root{
    --bg:#0B0F14; --panel:#121820; --ink:#E6F0FF; --muted:#A4B1C3; --focus:#65D1FF;
    --success:#2ECC71; --warn:#F1C40F; --danger:#E74C3C; --info:#3498DB;
    --radius:12px; --tap:44px; --space:16px; --space-lg:24px; --font:16px;
    --topbar:56px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font:400 var(--font)/1.6 system-ui,Segoe UI,Apple SD Gothic Neo,Noto Sans KR,Roboto,Arial,sans-serif}
  .topbar{height:var(--topbar);display:flex;align-items:center;justify-content:space-between;padding:0 var(--space-lg);background:#0E141C;border-bottom:1px solid #1b2634;position:sticky;top:0;z-index:10}
  .brand{font-weight:700}
  .focus-ring:focus{outline:3px solid var(--focus);box-shadow:0 0 0 8px rgba(101,209,255,.2);border-radius:8px}
  .top-actions{display:flex;align-items:center;gap:10px}
  .top-actions input[type="search"]{height:36px;padding:6px 10px;border-radius:8px;border:1px solid #2a3a4f;background:#0F1720;color:var(--ink);min-width:260px}
  .chip{padding:6px 10px;border-radius:8px;border:1px solid #27415a;background:#15202B;color:var(--ink);cursor:pointer}
  .layout{display:grid;grid-template-columns:280px 1fr;min-height:calc(100% - var(--topbar))}
  .sidebar{border-right:1px solid #1b2634;background:#0E141C;padding:12px}
  .nav a{display:flex;align-items:center;gap:10px;padding:10px 12px;margin:4px 0;border-radius:8px;text-decoration:none;color:var(--ink)}
  .nav a.active{background:#16202C}
  .main{padding:16px}
  .kpi{display:grid;grid-template-columns:repeat(4,minmax(200px,1fr));gap:16px}
  .tile{background:var(--panel);padding:16px;border-radius:12px;border:1px solid #1b2634}
  .led{display:inline-block;width:12px;height:12px;border-radius:50%;margin-right:8px;box-shadow:0 0 6px currentColor,inset 0 0 2px currentColor}
  .btns{display:flex;flex-wrap:wrap;gap:12px;margin:16px 0}
  .btn{min-height:var(--tap);padding:10px 16px;border-radius:8px;border:1px solid #27415a;background:#15202B;color:var(--ink);cursor:pointer;font-weight:600}
  .btn.primary{border-color:#2b6cb0;background:#1b2940}
  .btn.danger{border-color:#a33;background:#3a1616}
  .btn:focus{outline:3px solid var(--focus);box-shadow:0 0 0 8px rgba(101,209,255,.2)}
  .tabs{display:flex;gap:8px;margin:8px 0 16px}
  .tab{padding:8px 12px;border-radius:8px;background:#16202C;cursor:pointer}
  .tab.active{background:#213043}
  .card{background:var(--panel);padding:16px;border-radius:12px;border:1px solid #1b2634;margin-bottom:12px}
  .toast{position:fixed;right:16px;bottom:16px;background:#111a24;color:var(--ink);padding:12px 16px;border-radius:8px;border:1px solid #223246;opacity:.98}
  .mode{display:flex;align-items:center;gap:8px}
  /* SplitPane (패널 레이아웃) */
  .split{display:grid;grid-template-columns:42% 12px 1fr;gap:0;min-height:460px}
  .pane{overflow:auto;border:1px solid #1b2634;border-radius:12px;background:var(--panel)}
  .handle{width:12px;cursor:col-resize;margin:0 8px;background:linear-gradient(#1b2634,#1b2634) center/2px 80% no-repeat;border-radius:8px}
  .handle:focus{outline:3px solid var(--focus)}
  /* 접근성 옵션 */
  .readable{font-size:18px}
  @media (max-width:1024px){ .kpi{grid-template-columns:repeat(2,1fr)} .layout{grid-template-columns:1fr} .split{grid-template-columns:1fr} .handle{display:none} }
</style>
<script src="./public/ak7-bridge.js"></script>

<!-- AK7_TEST_PANEL_V2 -->
<style>.ak7-test{position:fixed;top:50%;right:10px;transform:translateY(-50%);z-index:99999;background:#121722;border:1px solid #2a3244;border-radius:12px;padding:10px;font:12px/1.4 Segoe UI,Malgun Gothic,sans-serif} .ak7-test button{margin:2px;padding:6px 10px;border-radius:8px;border:1px solid #3a4a66;cursor:pointer}</style>
<div class="ak7-test">
  <div style="opacity:.7;margin-bottom:4px">AK7 Quick Test</div>
  <button id="ak7-b-health">/health</button>
  <button id="ak7-b-prefs">/api/ak7/prefs</button>
  <button id="ak7-b-next">postAction("next")</button>
  <button id="ak7-b-scan">/api/ak7/scan</button>
  <button id="ak7-b-test">/api/ak7/test</button>
  <button id="ak7-b-fix">/api/ak7/fixloop</button>
  <button id="ak7-b-sse">connect /events</button>
  <pre id="ak7-out" style="max-width:460px;max-height:200px;overflow:auto;margin:6px 0 0;white-space:pre-wrap"></pre>
</div>
<script>(function(){
const out=document.getElementById("ak7-out"); function log(x){ try{ out.textContent=((typeof x==="string")?x:JSON.stringify(x,null,2)) }catch(e){ out.textContent=String(x) } }
const base = location.origin && location.origin!=="null" ? location.origin : "http://localhost:5191";
document.getElementById("ak7-b-health").onclick=async()=>{ try{ let r=await fetch(base+"/health"); log(await r.text()) }catch(e){ log(e.message) } };
document.getElementById("ak7-b-prefs").onclick=async()=>{ try{ let r=await fetch(base+"/api/ak7/prefs"); log(await r.text()) }catch(e){ log(e.message) } };
document.getElementById("ak7-b-next").onclick=async()=>{ try{ let r=await (window.AK7&&AK7.postAction?AK7.postAction("next",{}):Promise.resolve({ok:false,error:"AK7 bridge not loaded"})); log(r) }catch(e){ log(e.message) } };
document.getElementById("ak7-b-scan").onclick=async()=>{ try{ let r=await fetch(base+"/api/ak7/scan"); log(await r.text()) }catch(e){ log(e.message) } };
document.getElementById("ak7-b-test").onclick=async()=>{ try{ let r=await fetch(base+"/api/ak7/test"); log(await r.text()) }catch(e){ log(e.message) } };
document.getElementById("ak7-b-fix").onclick=async()=>{ try{ let r=await fetch(base+"/api/ak7/fixloop"); log(await r.text()) }catch(e){ log(e.message) } };
var es=null;
document.getElementById("ak7-b-sse").onclick=()=>{ try{ if(es){ es.close(); es=null; log("SSE: reconnect"); } es=new EventSource(base+"/events"); es.onmessage=(ev)=>{ log("message: "+ev.data) }; es.addEventListener("log",(ev)=>{ log("log: "+ev.data) }); es.addEventListener("ping",(ev)=>{ log("ping: "+ev.data) }); es.onerror=(e)=>{ console.error(e); }; }catch(e){ log(e.message) } };
})();</script>
<!-- AK7_OFFLINE_MODE_V1 -->
<script>(function(){
  try{
    window.AK7_FORCE_OFFLINE = true; // 필요 시 콘솔에서 false로 바꿔 서버 모드 복귀
    var of = window.fetch ? window.fetch.bind(window) : null;
    window.fetch = function(input, init){
      try{
        var url = (typeof input==="string")?input:((input&&input.url)||"");
        var m = url && url.match(/^https?:\/\/localhost:\d+(\/.*)?$/);
        var path = m ? (m[1]||"/") : url;
        if(window.AK7_FORCE_OFFLINE){
          var ok = function(d){ return new Response(JSON.stringify(d),{status:200,headers:{"Content-Type":"application/json"}}) };
          if(path==="/health") return Promise.resolve(ok({ok:true,service:"ak7",port:0,offline:true}));
          if(path==="/api/ak7/prefs") return Promise.resolve(ok({prefs:{theme:"dark",zoom:1,ok:true,offline:true}}));
          var m2 = path && path.match(/^\/api\/ak7\/([^\/?#]+)/);
          if(m2) return Promise.resolve(ok({ok:true,action:m2[1],offline:true}));
          return Promise.resolve(new Response(JSON.stringify({ok:false,error:"offline_not_found"}),{status:404,headers:{"Content-Type":"application/json"}}));
        }
      }catch(e){}
      return of ? of(input,init) : Promise.reject(new Error("fetch not available"));
    };
    // AK7.postAction 오프라인 응답
    window.AK7 = window.AK7 || {};
    window.AK7.postAction = function(action, body){ return Promise.resolve({ok:true,action:String(action||""),offline:true}); };
    // EventSource 대체(SSE 흉내)
    var OrigES = window.EventSource;
    window.EventSource = function(url){
      if(window.AK7_FORCE_OFFLINE && /localhost:\d+\/events/.test(String(url))){
        var es={};
        var t1=setInterval(function(){ var msg={event:"ping",ts:new Date().toISOString(),offline:true}; try{ if(es.onmessage) es.onmessage({data:JSON.stringify(msg)}) }catch(e){} },3000);
        es.addEventListener=function(type,cb){ if(type==="log"){ setInterval(function(){ try{ cb({data:JSON.stringify({event:"log",ts:new Date().toISOString(),offline:true})}) }catch(e){} },5000) } };
        es.close=function(){ clearInterval(t1); };
        console.log("AK7 SSE offline polyfill active");
        return es;
      }
      return new OrigES(url);
    };
    console.log("AK7 offline mode active");
  }catch(e){ console.error(e) }
})();</script>
<!-- AK7_OFFLINE_TOGGLE_V1 -->
<style>.ak7-pill{position:fixed;left:10px;top:10px;z-index:99999;background:#121722;border:1px solid #2a3244;border-radius:999px;padding:6px 12px;font:12px/1 Segoe UI,Malgun Gothic;color:#e9eef5}.ak7-pill .dot{display:inline-block;width:8px;height:8px;border-radius:999px;margin-right:6px;background:#2cff8a}.ak7-pill.off .dot{background:#ff7b8a}.ak7-offbtn{margin-left:8px;border:1px solid #3a4a66;border-radius:8px;padding:4px 8px;cursor:pointer}</style>
<div id="ak7-pill" class="ak7-pill off"><span class="dot"></span><span id="ak7-pill-text">OFFLINE</span><button id="ak7-toggle" class="ak7-offbtn">Go Online</button></div>
<script>(function(){
  function render(){ var p=document.getElementById("ak7-pill"); var lbl=document.getElementById("ak7-pill-text"); var off=!!window.AK7_FORCE_OFFLINE; if(off){ p.classList.add("off"); lbl.textContent="OFFLINE"; } else { p.classList.remove("off"); lbl.textContent="ONLINE"; } }
  window.addEventListener("DOMContentLoaded", function(){ render(); var btn=document.getElementById("ak7-toggle"); btn.onclick=function(){ window.AK7_FORCE_OFFLINE = !window.AK7_FORCE_OFFLINE; try{ if(window.AK7_TOAST){ AK7_TOAST(window.AK7_FORCE_OFFLINE?"warn":"ok", window.AK7_FORCE_OFFLINE?"Offline mode enabled":"Online mode enabled","Mode"); } }catch(e){} render(); }; });
})();</script>

<!-- AK7_G5_MOVE_V1 -->
<style id="ak7-g5-style">
#ak7-g5{position:fixed!important;right:auto!important;bottom:0!important;left:0!important;margin:0!important;z-index:100001!important;transform:none!important}
</style>
<script>(function(){
  function isG5(el){ if(!el) return false; if((el.id||"").toLowerCase().includes("g5")) return true;
    if((el.dataset&&el.dataset.g5)!=null) return true;
    var t=(el.textContent||"").trim(); return t==="G5"; }
  function pickG5(){
    var cands=[].slice.call(document.querySelectorAll("*")).filter(isG5);
    // 우선순위: 이미 fixed인 것 → 버튼/배지처럼 보이는 것 → 첫번째
    var fixed=cands.find(e=>getComputedStyle(e).position==="fixed"); if(fixed) return fixed;
    var btn=cands.find(e=>/button|badge|pill|chip/i.test(e.className)); if(btn) return btn;
    return cands[0]||null;
  }
  function move(){
    var g5=pickG5(); if(!g5) return false;
    g5.id="ak7-g5";
    // 직접 스타일 보강(부모 레이아웃 영향 제거)
    try{ g5.style.position="fixed"; g5.style.right="auto"; g5.style.bottom="0"; g5.style.left="0"; g5.style.margin="0"; g5.style.zIndex="100001"; }catch(_){ }
    return true;
  }
  window.addEventListener("DOMContentLoaded", function(){
    if(move()) return;
    // 늦게 그려지는 경우 2초간 재시도
    var n=0, tm=setInterval(function(){ if(move()||++n>10) clearInterval(tm); }, 200);
  });
})();</script>
<!-- AK7_G5_AUX_MOVE_LEFT_V1 -->
<style id="ak7-g5-aux-style">.ak7-g5-aux-left{position:fixed!important;left:8px!important;right:auto!important;bottom:64px!important;top:auto!important;margin:0!important;z-index:100000!important;transform:none!important}</style>
<script>(function(){
function isCand(el){ if(!el) return false; if((el.id||"")==="ak7-g5") return false;
  var id=(el.id||"").toLowerCase(); var cl=(el.className||"").toString().toLowerCase();
  if(el.getAttribute && (el.getAttribute("data-g5-panel")!=null || el.getAttribute("data-role")==="g5-panel")) return true;
  return (/g5/.test(id+" "+cl) && /(panel|dock|helper|console|widget|tray|overlay)/.test(id+" "+cl)); }
function pick(){
  var list=[].slice.call(document.querySelectorAll("*")).filter(isCand);
  if(!list.length){
    var b=document.getElementById("ak7-g5"); if(b){ var br=b.getBoundingClientRect();
      list=[].slice.call(document.body.children).filter(function(el){
        if(el===b) return false; var r=el.getBoundingClientRect();
        var dist=Math.abs(r.left-br.left)+Math.abs(r.top-br.top);
        return dist<500 && r.width>40 && r.height>30; }); }
  }
  if(!list.length) return null;
  list.sort(function(a,b){ var ra=a.getBoundingClientRect(), rb=b.getBoundingClientRect();
    return (rb.width*rb.height)-(ra.width*ra.height); });
  return list[0];
}
function move(){ var el=pick(); if(!el) return false; if(!el.id) el.id="ak7-g5-aux";
  try{ el.classList.add("ak7-g5-aux-left");
    el.style.position="fixed"; el.style.left="8px"; el.style.right="auto"; el.style.bottom="64px"; el.style.top="auto"; el.style.margin="0"; el.style.zIndex="100000";
  }catch(_){ } return true; }
window.addEventListener("DOMContentLoaded",function(){ if(move()) return; var n=0,tm=setInterval(function(){ if(move()||++n>20) clearInterval(tm); },200); });
})();</script>
<!-- AK7_ROLLBACK_HOOK_V1 -->
<script>(function(){
  function findRollbackButtons(){
    return [].slice.call(document.querySelectorAll("button, a, .btn")).filter(function(el){
      var s=(el.textContent||"").trim().toLowerCase();
      return s.startsWith("rollback")||s.indexOf("rollback ")===0;
    });
  }
  async function callApi(url, body){
    try{ let r = await fetch(url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body||{})});
         return await r.json(); }catch(e){ return {ok:false,error:e.message} }
  }
  function toToast(msg,level){
    try{ if(window.AK7_TOAST){ AK7_TOAST(level||"ok", msg, "Rollback") } else { console.log("Rollback:",msg) } }catch(_){}
  }
  function bind(){
    var list=findRollbackButtons();
    list.forEach(function(el){
      if(el._ak7Bind) return; el._ak7Bind=true;
      el.addEventListener("click", async function(ev){
        ev.preventDefault();
        var label=(el.textContent||"").trim();
        var name=label.replace(/.*?rollback\s*/i,"").trim()||"good-1";

        if(window.AK7_FORCE_OFFLINE){
          // ⚠ 오프라인: PowerShell 한 줄 복붙 안내(템플릿 리터럴 사용)
          var cmd = `pwsh -File scripts\\g5\\ak7-cli.ps1 -RollbackRestore -RollbackName ${name}`;
          toToast("오프라인 모드: 콘솔에서 아래 실행\n"+cmd,"warn");
          return;
        }

        var base = location.origin==="null" ? "http://localhost:5192" : location.origin;
        var res  = await callApi(base+"/api/ak7/rollback/restore",{name:name});
        if(res && res.ok){
          toToast("복원 완료: "+(res.restored||name),"ok");
          setTimeout(function(){ location.reload(); }, 1200);
        } else {
          toToast("복원 실패: "+(res && res.error || "unknown"),"err");
        }
      });
    });
  }
  window.addEventListener("DOMContentLoaded", function(){ bind(); setInterval(bind, 1500); });
})();</script>
<!-- AK7_AUTOSNAP_V1 -->
<style>
#ak7-autosnap{display:inline-flex;align-items:center;margin-left:8px;padding:2px 8px;border:1px solid #3a4a66;border-radius:8px;font:12px/1 Segoe UI,Malgun Gothic;color:#e9eef5;background:#121722}
#ak7-autosnap input{margin:0 6px}
</style>
<script>(function(){
  function base(){ return (location.origin && location.origin!=="null") ? location.origin : "http://localhost:5192"; }
  function pref(v){ if(arguments.length){ try{ localStorage.setItem("ak7.autosnap", v?"1":"0") }catch(_){} } try{ return localStorage.getItem("ak7.autosnap")!=="0" }catch(_){ return true } }
  async function preSnapshot(tag){
    if(!pref()) return;
    var name = "auto-"+new Date().toISOString().replace(/[-:.TZ]/g,"").slice(0,14)+"-"+(tag||"act");
    if(window.AK7_FORCE_OFFLINE){
      var cmd = `pwsh -File scripts\\g5\\ak7-cli.ps1 -RollbackCreate -RollbackName ${name}`;
      try{ if(window.AK7_TOAST){ AK7_TOAST("warn","AutoSnapshot(offline):\n"+cmd,"Rollback") } }catch(_){}
      return;
    }
    try{
      let r = await fetch(base()+"/api/ak7/rollback/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name})});
      let j = await r.json();
      if(j && j.ok){ try{ AK7_TOAST && AK7_TOAST("ok","Snapshot created: "+(j.point||name),"Rollback") }catch(_){ } }
      else{ try{ AK7_TOAST && AK7_TOAST("warn","Snapshot failed","Rollback") }catch(_){ } }
    }catch(e){ try{ AK7_TOAST && AK7_TOAST("warn","Snapshot error: "+e.message,"Rollback") }catch(_){ } }
  }
  function attachToggle(){
    var p=document.getElementById("ak7-pill");
    if(!p || document.getElementById("ak7-autosnap")) return;
    var box=document.createElement("label"); box.id="ak7-autosnap";
    box.innerHTML = 'AutoSnapshot <input type="checkbox" id="ak7-autosnap-cb"> ON';
    p.parentNode.insertBefore(box, p.nextSibling);
    var cb=document.getElementById("ak7-autosnap-cb"); cb.checked=pref(); cb.onchange=function(){ pref(cb.checked); try{ AK7_TOAST && AK7_TOAST("ok",(cb.checked?"ON":"OFF"),"AutoSnapshot") }catch(_){} };
  }
  function captureClicks(){
    document.addEventListener("click", function(ev){
      var el=ev.target;
      var id=(el.id||"");
      var txt=(el.textContent||"").toLowerCase();
      // Quick Test 버튼 id들
      if(id==="ak7-b-scan"){ preSnapshot("scan"); return; }
      if(id==="ak7-b-test"){ preSnapshot("test"); return; }
      if(id==="ak7-b-fix"){  preSnapshot("fixloop"); return; }
      if(id==="ak7-b-next"){ preSnapshot("next"); return; }
      // 텍스트 기반 일반 버튼(Apply/FixLoop/Next/Scan/Test)
      if(/\b(apply|fixloop|scan|test|next)\b/.test(txt)){ preSnapshot(txt.replace(/.*\b(apply|fixloop|scan|test|next)\b.*/,'$1')); }
    }, true); // capture: 선 스냅샷 후 기존 핸들러 실행
  }
  // 복원 미리보기(콘솔용): AK7.previewRollback('이름')
  window.AK7 = window.AK7 || {};
  window.AK7.previewRollback = async function(name){
    name = name || "last";
    if(window.AK7_FORCE_OFFLINE){ try{ AK7_TOAST && AK7_TOAST("warn","Offline: preview는 서버 필요","Rollback") }catch(_){ } return; }
    try{
      let r = await fetch(base()+"/api/ak7/rollback/preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name})});
      let j = await r.json();
      if(j && j.ok){
        var files=(j.files||[]); var msg=(files.slice(0,10).join("\\n")); if(files.length>10) msg += `\n(+${files.length-10} more)`;
        AK7_TOAST && AK7_TOAST("ok", msg || "변경 없음", "Preview: "+(j.restored||name));
      } else {
        AK7_TOAST && AK7_TOAST("err", (j && j.error)||"preview failed", "Rollback");
      }
    }catch(e){ AK7_TOAST && AK7_TOAST("err", e.message, "Rollback") }
  }

  window.addEventListener("DOMContentLoaded", function(){
    attachToggle(); captureClicks();
    // pill 이동 스크립트가 늦게 적용될 수 있어 재시도
    var n=0,tm=setInterval(function(){ attachToggle(); if(++n>10) clearInterval(tm); },300);
  });
})();
</script>

<!-- AK7_DOM_LOCK_V1 -->
<script>(function(){
  if(window.__AK7_DOM_LOCK) return; window.__AK7_DOM_LOCK=true;

  // 기본: 잠금 ON
  window.AK7_LOCKDOWN = true;
  window.AK7 = window.AK7 || {};

  // 허용 예외: 잠깐 특정 노드만 이동 허가
  window.AK7.permitMove = function(selector, ms){
    try{
      window.__AK7_PERMIT = window.__AK7_PERMIT || new WeakSet();
      var el = document.querySelector(selector);
      if(el){ window.__AK7_PERMIT.add(el); setTimeout(function(){ try{ window.__AK7_PERMIT.delete(el) }catch(_){ } }, ms||1500); }
    }catch(_){}
  };

  function isFixed(node){
    return !!(node && node.nodeType===1 && node.dataset && node.dataset.ak7Fixed==="1");
  }
  function permitted(node){
    if(!window.AK7_LOCKDOWN) return true;
    if(!isFixed(node)) return true;
    if(window.__AK7_PERMIT && window.__AK7_PERMIT.has(node)) return true;
    return false;
  }

  // 원 메서드 보관
  var ORG = {
    appendChild: Node.prototype.appendChild,
    insertBefore: Node.prototype.insertBefore,
    removeChild: Node.prototype.removeChild,
    remove: Element.prototype.remove
  };

  // 이동/삭제 차단 래핑
  Node.prototype.appendChild = function(child){ if(!permitted(child)){ console.log("[AK7-LOCK] block append", child.id||child); return child } return ORG.appendChild.call(this, child) };
  Node.prototype.insertBefore = function(newNode, ref){ if(!permitted(newNode)){ console.log("[AK7-LOCK] block insert", newNode.id||newNode); return newNode } return ORG.insertBefore.call(this, newNode, ref) };
  Node.prototype.removeChild = function(child){ if(!permitted(child)){ console.log("[AK7-LOCK] block removeChild", child.id||child); return child } return ORG.removeChild.call(this, child) };
  Element.prototype.remove = function(){ if(!permitted(this)){ console.log("[AK7-LOCK] block remove", this.id||this); return } return ORG.remove.call(this) };

  // 상단 툴바(테마 버튼 포함) 자식들을 "기존요소=고정" 표시
  function findTheme(){
    var cands = Array.from(document.querySelectorAll('button,.btn,[role="button"],[class*="chip"],[class*="pill"],*[title],*[aria-label]'));
    return cands.find(function(el){
      var t=((el.textContent||"")+' '+(el.getAttribute? (el.getAttribute("title")||"") :"")+' '+(el.getAttribute? (el.getAttribute("aria-label")||"") :"")).toLowerCase();
      return /테마|theme/.test(t);
    }) || null;
  }
  function markFixed(){
    try{
      var theme=findTheme();
      var bar = (theme && (theme.closest("header,.toolbar,nav,.topbar,.header") || theme.parentElement)) || null;
      if(bar){
        Array.from(bar.children).forEach(function(el){ try{ el.dataset.ak7Fixed="1"; }catch(_){ } });
      }
      var pill=document.getElementById("ak7-pill");
      if(pill){ pill.dataset.ak7Fixed="1"; } // Pill은 무조건 고정
    }catch(_){}
  }

  document.addEventListener("DOMContentLoaded", function(){ markFixed(); setTimeout(markFixed,200); });
})();</script>
<!-- AK7_AUTOSNAP_SAFE_POS_V1 -->
<style>
  #ak7-autosnap-chip{ display:inline-flex; align-items:center; height:24px;
    margin-left:8px; margin-right:0; background:transparent; border:0; padding:0; white-space:nowrap; flex:0 0 auto; }
  #ak7-autosnap-chip .lbl{ opacity:.9; margin-right:6px }
  #ak7-autosnap-chip input{ margin:0; transform:scale(.95) }
</style>
<script>(function(){
  if(window.__AK7_AS_SAFE) return; window.__AK7_AS_SAFE=true;

  function pref(v){
    try{ if(arguments.length){ localStorage.setItem("ak7.autosnap", v?"1":"0"); return v }
         return localStorage.getItem("ak7.autosnap")!=="0" }catch(_){ return true }
  }

  function ensureChip(){
    var chip=document.getElementById("ak7-autosnap-chip");
    if(!chip){
      chip=document.createElement("label"); chip.id="ak7-autosnap-chip";
      var lbl=document.createElement("span"); lbl.className="lbl"; lbl.textContent="AutoSnapshot";
      var cb=document.createElement("input"); cb.type="checkbox"; cb.id="ak7-autosnap-cb";
      chip.append(lbl,cb);
    }else{
      if(!chip.querySelector(".lbl")){ var lbl=document.createElement("span"); lbl.className="lbl"; lbl.textContent="AutoSnapshot"; chip.insertBefore(lbl, chip.firstChild); }
      if(!chip.querySelector("#ak7-autosnap-cb")){ var cb=document.createElement("input"); cb.type="checkbox"; cb.id="ak7-autosnap-cb"; chip.appendChild(cb); }
    }
    var cb = chip.querySelector("#ak7-autosnap-cb");
    cb.checked = pref();
    cb.onchange = function(){ pref(cb.checked); try{ window.AK7_TOAST && AK7_TOAST("ok", (cb.checked?"ON":"OFF"), "AutoSnapshot") }catch(_){ } };
    return chip;
  }

  function place(){
    var pill=document.getElementById("ak7-pill");
    if(!pill || !pill.parentNode) return false;

    var chip=ensureChip();

    // ★ 잠깐 이동 허용(이 칩만) 후 Pill의 오른쪽 형제로 배치
    if(window.AK7 && AK7.permitMove){ AK7.permitMove("#ak7-autosnap-chip", 1500); }
    if(chip.parentNode !== pill.parentNode || pill.nextSibling !== chip){
      try{ pill.parentNode.insertBefore(chip, pill.nextSibling); }catch(_){}
    }
    try{ chip.style.height = (parseInt(getComputedStyle(pill).height,10)||24) + "px"; }catch(_){}
    return true;
  }

  document.addEventListener("DOMContentLoaded", function(){
    place();
    // 초기 지연/동적 레이아웃 대응
    var n=0, tm=setInterval(function(){ if(place() && ++n>5) clearInterval(tm); else if(++n>12) clearInterval(tm); }, 200);
    try{ new MutationObserver(function(){ place() }).observe(document.body,{childList:true,subtree:true}); }catch(_){}
  });
})();</script>
</head>
<body>
  <div class="topbar" role="region" aria-label="상단바">
    <div class="brand">AUTO‑KOBONG Monitor</div>
    <div class="top-actions">
      <input id="q" type="search" placeholder="검색 (Ctrl+/)" aria-label="검색">
      <button class="chip" id="cmdk" title="커맨드 팔레트 (Ctrl+K)">⌘K</button>
      <button class="chip" id="readability">가독 모드</button>
      <button class="chip" id="zoom">줌 100%</button>
      <button class="chip" id="theme">테마</button>
    </div>
    <div class="mode" role="group" aria-label="실행 모드">
      <label><input type="radio" name="mode" value="readonly" checked> 읽기전용</label>
      <label><input type="radio" name="mode" value="dry-run"> Dry‑Run</label>
      <label><input type="radio" name="mode" value="apply"> Apply</label>
    </div>
  </div>

  <div class="layout">
    <aside class="sidebar">
      <nav class="nav" id="nav">
        <a href="#/overview" class="active">개요(Overview)</a>
        <a href="#/timeline">타임라인</a>
        <a href="#/messages">메시지</a>
        <a href="#/shells">Shells</a>
        <a href="#/errorkb">Error‑KB</a>
        <a href="#/settings">설정</a>
        <a target="_blank" rel="noopener" href="gh-console://open" title="GitHub 모니터링 열기">GitHub 모니터</a>
      </nav>
    </aside>

    <main class="main">
      <!-- Overview -->
      <section id="overview">
        <div class="kpi" aria-label="KPI 리본">
          <div class="tile"><span class="led" style="color:#34D399"></span>오늘 요청 <b id="kpi-req">0</b></div>
          <div class="tile"><span class="led" style="color:#F87171"></span>에러율 <b id="kpi-err">0%</b></div>
          <div class="tile"><span class="led" style="color:#60A5FA"></span>p95 지연 <b id="kpi-p95">0ms</b></div>
          <div class="tile"><span class="led" style="color:#F59E0B"></span>Busy(429) <b id="kpi-busy">0</b></div>
        </div>
        <div class="btns" role="group" aria-label="큰 버튼">
          <button class="btn primary" data-action="exec_next">다음 단계 실행</button>
          <button class="btn" data-action="cancel">중단</button>
          <button class="btn" data-action="fixloop_preview">FixLoop 미리보기</button>
          <button class="btn primary" data-action="fixloop_apply">FixLoop 적용</button>
          <button class="btn" data-action="mark_good">Mark Good</button>
          <button class="btn danger" data-action="rollback_latest">Rollback good‑1</button>
          <button class="btn" data-action="shell_open">셸 열기</button>
          <button class="btn" data-action="export_logs">로그/요약 내보내기</button>
        </div>
        <div class="card">고대비/큰 버튼/44×44/LED/키보드 단축키를 기본 제공합니다. (Ctrl+K, Ctrl+/, Alt+1..3)</div>
      </section>

      <!-- Timeline: 좌 리스트 / 우 디테일 (SplitPane) -->
      <section id="timeline" style="display:none" aria-label="타임라인">
        <div class="split" id="split-timeline" data-ratio="0.42">
          <div class="pane" id="panel-left" aria-label="이벤트 리스트">
            <div class="list-toolbar card">필터: <select id="filter-intent"><option value="">전체</option><option>exec</option><option>plan</option><option>error</option></select></div>
            <div id="timeline-list" class="list virtual-list" aria-label="이벤트 목록"></div>
          </div>
          <div class="handle" id="split-handle" role="separator" aria-orientation="vertical" tabindex="0" aria-label="패널 크기 조절"></div>
          <div class="pane" id="panel-right" aria-label="상세">
            <div id="detail-card" class="card">항목을 선택하면 상세가 여기에 표시됩니다.</div>
          </div>
        </div>
      </section>

      <!-- Messages -->
      <section id="messages" data-ak7-messages style="display:none">
        <div class="tabs" role="tablist">
          <div class="tab active" role="tab" aria-selected="true">요청</div>
          <div class="tab" role="tab">응답</div>
          <div class="tab" role="tab">정책/서명</div>
        </div>
        <div class="card">민감정보 마스킹 토글과 headers/body 뷰를 제공합니다.</div>
      </section>

      <!-- Shells -->
      <section id="shells" style="display:none"><div class="card">xterm.js 연동 예정 — 3단 모드(읽기전용→Dry‑Run→Apply).</div></section>

      <!-- Error-KB -->
      <section id="errorkb" style="display:none"><div class="card">재발 지문(fingerprint) 추천 조치·FixLoop 링크와 연계.</div></section>

      <!-- Settings -->
      <section id="settings" style="display:none"><div class="card">알림 임계/토큰 상한/테마/줌/가독 설정.</div></section>
    </main>
  </div>

  <div id="help" class="card" style="position:fixed;left:16px;bottom:16px;display:none;max-width:420px">
    <b>단축키</b>: Ctrl+/ 검색 · Ctrl+K 커맨드 팔레트 · Alt+1 개요 · Alt+2 타임라인 · Alt+3 메시지 · Alt+←/→ 패널폭 ±5% · ? 도움말
  </div>

  <script defer src="app.js"></script>
<script id="g5-config">
  (function(){
    // 한 번만 설정: 항상 localhost:18080 사용
    window.API_BASE = 'http://localhost:18080';
    try { localStorage.setItem('G5_API_BASE', window.API_BASE); } catch(e) {}
  })();
</script>
<script id="g5-file-origin-fix">
(function(){
  if (window.__g5FileOriginFix) return;
  window.__g5FileOriginFix = true;

  const prevFetch = window.fetch.bind(window);
  const HOSTS = ['http://localhost:18080','http://127.0.0.1:18080','http://localhost:18085'];

  function apiInfo(u){
    try{
      if (typeof u === 'string'){
        if (/^\/?api\//.test(u)) return {path: u.startsWith('/')?u:'/'.concat(u)};
        const url = new URL(u, location.href);
        if (url.pathname.startsWith('/api/')) return {path: url.pathname + url.search};
        return null;
      }
      if (u && typeof u.url === 'string') return apiInfo(u.url);
    }catch(e){}
    return null;
  }

  function rewrite(u, host, info){
    const full = host + info.path;
    if (typeof u === 'string') return full;
    return new Request(full, u);
  }

  function synthResponse(info){
    // 요청 경로별 모의 응답
    if (info.path.startsWith('/api/kpi')){
      const body = {
        req_today: 1, err_rate: 0, p95_ms: 300,
        tokens_in: 0, tokens_out: 0, busy: 0, ts: new Date().toISOString()
      };
      return new Response(JSON.stringify(body), {status:200, headers:{'Content-Type':'application/json'}});
    }
    if (info.path.startsWith('/api/events')){
      const body = [{id:1,time:new Date().toISOString(),type:'info',text:'offline fallback'}];
      return new Response(JSON.stringify(body), {status:200, headers:{'Content-Type':'application/json'}});
    }
    // 그 외는 실패 그대로
    throw new Error('All API hosts failed');
  }

  window.fetch = async function(input, init){
    const info = apiInfo(input);
    // file:// 또는 절대경로여도 API면 폴백 시도
    if (info){
      let lastErr;
      for (const host of HOSTS){
        try{
          const patched = rewrite(input, host, info);
          const res = await prevFetch(patched, init);
          if (res && res.status < 500) {
            try { localStorage.setItem('G5_API_BASE', host); } catch(e){}
            return res;
          }
          lastErr = new Error('Upstream '+(res && res.status));
        }catch(e){ lastErr = e }
      }
      // 서버 전부 실패 → 모의 응답(200)
      console.warn('[G5] API offline, using fallback for', info.path);
      return synthResponse(info);
    }
    return prevFetch(input, init);
  };
})();
</script>
<script id="g5-kpi-normalize">
(function(){
  if (window.__g5KpiNormalizeInstalled) return;
  window.__g5KpiNormalizeInstalled = true;
  const origFetch = window.fetch;

  function toIso(v){
    try{
      if(!v) return new Date().toISOString();
      if (typeof v==='string' && /^\d{4}-\d{2}-\d{2}T/.test(v)) return v;
      return new Date(v).toISOString();
    }catch(e){ return new Date().toISOString(); }
  }
  function normalize(kpi){
    return {
      req_today:  kpi.req_today ?? kpi.req ?? 0,
      err_rate:   kpi.err_rate  ?? kpi.err ?? 0,
      p95_ms:     kpi.p95_ms    ?? kpi.p95 ?? 0,
      tokens_in:  kpi.tokens_in ?? 0,
      tokens_out: kpi.tokens_out ?? 0,
      busy:       kpi.busy ?? 0,
      ts:         toIso(kpi.ts)
    };
  }

  window.fetch = async function(input, init){
    const url = (typeof input==='string') ? input : (input && input.url) || '';
    const res = await origFetch(input, init);
    if (url && url.includes('/api/kpi')) {
      const clone = res.clone();
      try{
        const kpi = await clone.json();
        const out = normalize(kpi);
        return new Response(JSON.stringify(out), {
          status: res.status,
          statusText: res.statusText,
          headers: {'Content-Type':'application/json'}
        });
      }catch(e){}
    }
    return res;
  };
})();
</script>
<script id="g5-uiassist">;(function(){
  if(window.__g5UiAssist) return; window.__g5UiAssist = true;
  const API="/g5/prefs";

  (function(){ // same-origin force + API_BASE guard
    const ORIGIN=location.origin;
    function force(u){ try{ const t=new URL(u,ORIGIN); if(t.pathname.startsWith("/api/")){ t.host=location.host; t.protocol=location.protocol; return t.href; } }catch{} return u; }
    const of=window.fetch?.bind(window); if(of){ window.fetch=(u,o)=>of(force(u),o); }
    if(window.XMLHttpRequest){ const ox=XMLHttpRequest.prototype.open; XMLHttpRequest.prototype.open=function(m,u,...r){ return ox.call(this,m,force(u),...r); }; }
    try{ for(const k of ["API_BASE","akApiBase"]){ Object.defineProperty(window,k,{configurable:true,enumerable:true,get(){return location.origin;},set(){}}); } }catch{}
  })();

  const onReady=(fn)=> (document.readyState==="loading")?document.addEventListener("DOMContentLoaded",fn,{once:true}):fn();
  const qs=(s,el=document)=>el.querySelector(s);
  const ce=(t,p={})=>Object.assign(document.createElement(t),p);
  const store={ get(k,d){ try{const v=localStorage.getItem(k); return v===null?d:JSON.parse(v) }catch{return d} },
                set(k,v){ try{localStorage.setItem(k,JSON.stringify(v)); return true }catch{return false} } };

  const K_FEATURE="G5_FEATURES_ON";   // 기능 ON/OFF
  const K_PANEL  ="G5_PANEL_ON";      // 패널 표시/숨김
  let showPanel = store.get(K_PANEL, true);

  const st=ce("style",{id:"g5-uiassist-style"});
  st.textContent=`:root{--g5-zoom:1;--g5-led:#22d3ee}
    html{font-size:calc(100% * var(--g5-zoom))}
    .g5-led button,.g5-led .btn,[role="button"]{transition:box-shadow .15s ease,transform .05s ease}
    .g5-led button:hover,.g5-led .btn:hover,[role="button"]:hover{box-shadow:0 0 .5rem var(--g5-led),0 0 1.2rem rgba(34,211,238,.35)}
    .g5-hc :where(body,main,header,footer,section,article,div){background-color:#0b1020!important;color:#f5f7fb!important}
    .g5-hc a{color:#60a5fa!important;text-decoration:underline}
    .g5-outline *:focus{outline:3px solid #22d3ee!important;outline-offset:2px!important}
    .g5-cb :where(.ok,.success){color:#1fbc1f!important}.g5-cb :where(.warn){color:#ffb020!important}.g5-cb :where(.err,.danger){color:#d61e1e!important}
    #g5-panel{position:fixed;right:16px;bottom:140px;width:300px;padding:12px;background:linear-gradient(180deg,#0b1020,#0e1426);color:#e5e7eb;border:1px solid #374151;border-radius:16px;box-shadow:0 12px 30px rgba(0,0,0,.45);z-index:2147483646;font-family:system-ui,sans-serif}
    #g5-panel h3{margin:0 0 8px 0;font-size:14px;letter-spacing:.4px;opacity:.9}
    #g5-panel .row{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:8px 0}
    #g5-panel .small{font-size:11px;opacity:.7}
    #g5-panel input[type=range]{width:140px}
    #g5-links{display:flex;flex-wrap:wrap;gap:6px;margin-top:10px}
    #g5-links a{padding:6px 8px;border-radius:10px;background:#111827;border:1px solid #374151;color:#e5e7eb;font-size:12px;text-decoration:none}
    /* --- NAV FIX: 네비/사이드바/우패널 링크는 원래색+밑줄 없음 (※ 반드시 마지막에 위치) --- */
    .g5-hc :where(nav,.sidebar,.menu,.tabs,.toolbar,#right-panel,[data-pane="right"],.right) a{
      color:inherit !important; text-decoration:none !important;
    }`;
  onReady(()=>document.head.appendChild(st));

  function applyZoom(v){ const z=Math.max(1,Math.min(2,Number(v)||1)); document.documentElement.style.setProperty("--g5-zoom",String(z)); try{ document.body.style.zoom=String(z) }catch{} }
  function applyFeatures(pref, on){
    if(on){ applyZoom(pref.zoom||1); document.body.classList.toggle("g5-led",!!pref.led); document.body.classList.toggle("g5-hc",!!pref.hc); document.body.classList.toggle("g5-cb",!!pref.cb); document.body.classList.toggle("g5-outline",!!pref.focus); }
    else { applyZoom(1); document.body.classList.remove("g5-led","g5-hc","g5-cb","g5-outline"); }
  }

  let pref=null, feat=false;
  function renderPanel(){
    let p = qs("#g5-panel");
    if(!showPanel){ if(p) p.remove(); return; }
    if(!p){ p=ce("div",{id:"g5-panel"}); document.body.appendChild(p); }
    if(!pref){ p.innerHTML="<h3>G5 보조 패널</h3><div class='small'>로딩중…</div>"; return; }
    p.innerHTML=`<h3>G5 보조 패널</h3>
      <div class="row"><label><input id="g5-feat" type="checkbox" ${feat?"checked":""}> 기능 ON</label><span class="small">패널과 무관하게 유지</span></div>
      <div class="row"><label>글자 크기</label><input id="g5-zoom" type="range" min="1.0" max="2.0" step="0.05" value="${pref.zoom||1}"><span id="g5-zoom-val" class="small">${(pref.zoom||1)}x</span></div>
      <div class="row"><label><input id="g5-led" type="checkbox" ${pref.led?"checked":""}> LED 버튼</label><span class="small">가독/선택 강조</span></div>
      <div class="row"><label><input id="g5-hc"  type="checkbox" ${pref.hc?"checked":""}> 고대비</label><span class="small">어두운 배경+밝은 글씨</span></div>
      <div class="row"><label><input id="g5-cb"  type="checkbox" ${pref.cb?"checked":""}> 색약 팔레트</label><span class="small">성공/경고/오류 색 구분</span></div>
      <div class="row"><label><input id="g5-focus" type="checkbox" ${pref.focus?"checked":""}> 포커스 테두리</label><span class="small">키보드 이동 강조</span></div>
      <div id="g5-links"><a href="/status.html">Status</a><a href="/github.html">GitHub</a><a href="/console.html">Console</a><a href="/AUTO-Kobong-Han.html">AK-Han</a><a href="/api/kpi" target="_blank">KPI JSON</a></div>
      <div class="row" style="justify-content:flex-end; gap:6px; margin-top:8px">
        <button id="g5-save"  style="padding:6px 10px;border-radius:10px;border:1px solid #374151;background:#111827;color:#e5e7eb">저장</button>
        <button id="g5-hide"  style="padding:6px 10px;border-radius:10px;border:1px solid #374151;background:#1f2937;color:#e5e7eb">패널 숨김</button>
      </div>`;
    const $=(s)=>qs(s,p), $z=$("#g5-zoom"),$led=$("#g5-led"),$hc=$("#g5-hc"),$cb=$("#g5-cb"),$fo=$("#g5-focus"),$zv=$("#g5-zoom-val"),$sv=$("#g5-save"),$hd=$("#g5-hide"),$ft=$("#g5-feat");
    function syncApply(){
      const tmp={ zoom:Number($z.value)||1, led:$led.checked, hc:$hc.checked, cb:$cb.checked, focus:$fo.checked };
      pref = Object.assign({},pref,tmp);
      applyFeatures(pref, feat);
      $zv.textContent=(Number($z.value)||1).toFixed(2).replace(/\.00$/,"")+'x';
    }
    [$z,$led,$hc,$cb,$fo].forEach(el=>el.addEventListener("input",syncApply));
    $ft.addEventListener("change", async ()=>{
      feat = $ft.checked; store.set(K_FEATURE,feat);
      try{ await fetch(API,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...pref,on:feat})}); }catch{}
      syncApply();
    });
    $sv.addEventListener("click", async ()=>{
      store.set("G5_UI_PREF",pref);
      try{ await fetch(API,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...pref,on:feat})}); }catch{}
      syncApply();
    });
    $hd.addEventListener("click", ()=>{ showPanel=false; store.set(K_PANEL,false); renderPanel(); });
    syncApply();
  }

  const pill=ce("button",{id:"g5-pill",innerText:"G5",title:"Ctrl+Alt+G (패널 열기/숨김)"});
  Object.assign(pill.style,{position:"fixed",right:"16px",bottom:"16px",width:"44px",height:"44px",borderRadius:"12px",border:"1px solid #4e5568",background:"#111827",color:"#e5e7eb",fontWeight:"700",boxShadow:"0 8px 24px rgba(0,0,0,.35)",zIndex:2147483647,cursor:"pointer"});
  pill.onclick=()=>{ showPanel=!showPanel; store.set(K_PANEL,showPanel); renderPanel(); };
  onReady(()=>document.body.appendChild(pill));
  window.addEventListener("keydown",e=>{ if(e.ctrlKey&&e.altKey&&(e.key==="g"||e.key==="G")){ showPanel=!showPanel; store.set(K_PANEL,showPanel); renderPanel(); }});

  async function boot(){
    let sFeat = store.get(K_FEATURE, null);
    let server=null; try{ const r=await fetch(API,{cache:"no-cache"}); if(r.ok) server=await r.json(); }catch{}
    if(sFeat===null){ sFeat = (server && typeof server.on==="boolean") ? server.on : true; store.set(K_FEATURE,sFeat); }
    const prefLocal = store.get("G5_UI_PREF", null);
    pref = prefLocal || server || {zoom:1.2,led:true,hc:false,cb:false,focus:true,on:true};
    const feat = !!sFeat; // 유지
    onReady(()=>applyFeatures(pref, feat));
    renderPanel();
  }
  boot();
})();</script>
<script>window.AK7_API_BASE='http://localhost:8080/api/ak7';</script>
<script>window.AK7_API_FORCE='http://localhost:5191/api/ak7';window.AK7_API_BASE=window.AK7_API_FORCE;</script>
<script src="public/ak7-bridge.js"></script>
<script id="ak7-auto-wire">
(function(){
  try{
    if(document.getElementById('ak7-auto-wire-ran')) return;
    var flag=document.createElement('meta'); flag.id='ak7-auto-wire-ran'; document.head.appendChild(flag);
    var map=[
      {txt:["다음","다음 단계","Next"], act:"next"},
      {txt:["KLC","KLC 점검"],           act:"klc"},
      {txt:["중지","Stop"],              act:"stop"},
      {txt:["확정","Good"],              act:"good"},
      {txt:["Fix 미리보기","미리보기"],  act:"fix-preview"},
      {txt:["Fix 적용","적용"],          act:"fix-apply"},
      {txt:["롤백","Rollback"],          act:"rollback"}
    ];
    var q = function(s){ return document.querySelectorAll(s); };
    var cands = q('button, a[role="button"], .btn, [data-action], [aria-label]');
    cands.forEach(function(el){
      var label=(el.getAttribute('aria-label')||el.textContent||el.value||"").trim();
      map.some(function(m){
        return m.txt.some(function(k){
          if(label.includes(k)){
            if(!el.getAttribute('data-ak7-action')) el.setAttribute('data-ak7-action', m.act);
            return true;
          }
          return false;
        });
      });
    });
    // 브릿지가 자동 바인딩하지만 안전용 보강
    q('[data-ak7-action]').forEach(function(el){
      if(el.__ak7_wired) return;
      el.addEventListener('click', function(e){
        if(typeof AK7!=="undefined" && AK7.postAction){
          e.preventDefault();
          AK7.postAction(el.getAttribute('data-ak7-action'));
        }
      });
      el.__ak7_wired = true;
    });
  }catch(e){ console.warn("[ak7-auto-wire]", e); }
})();
</script><script id="ak7-filter-wire">
(function(){
  function host(){return document.querySelector("[data-ak7-messages]")||document.querySelector("#messages")||document.body;}
  function filter(type){
    var h=host();
    var cards=[].slice.call(h.querySelectorAll("[class*='-card']"));
    cards.forEach(function(c){
      var text=(c.textContent||"").toLowerCase();
      var title=(c.querySelector("strong")?c.querySelector("strong").textContent:"").toLowerCase();
      var show=true;
      if(type==="req"){ show = title.includes("request"); }
      else if(type==="res"){ show = title.includes("response"); }
      else if(type==="sig"){ show = text.includes("sig:") || text.includes("signature"); }
      else { show=true; }
      c.style.display = show? "" : "none";
    });
  }
  // 버튼 클릭시 필터 적용
  document.addEventListener("click", function(e){
    var b=e.target.closest("[data-ak7-filter]");
    if(!b) return;
    e.preventDefault();
    filter(b.getAttribute("data-ak7-filter")||"all");
  }, true);
  // 텍스트로 자동 매핑: "요청/응답/정책/서명" 들어간 버튼을 필터 버튼으로 지정
  var btns=document.querySelectorAll('button, a[role="button"], .btn, [aria-label]');
  [].forEach.call(btns,function(el){
    var lbl=(el.getAttribute("aria-label")||el.textContent||"").trim();
    if(!lbl || el.getAttribute("data-ak7-filter")) return;
    if(lbl.includes("요청")) el.setAttribute("data-ak7-filter","req");
    else if(lbl.includes("응답")) el.setAttribute("data-ak7-filter","res");
    else if(lbl.includes("정책") || lbl.includes("서명")) el.setAttribute("data-ak7-filter","sig");
  });
})();
</script><!-- AK7-PERSIST v1 -->
<script id="ak7-persist">
(()=>{if(window.__AK7_PERSIST__)return;window.__AK7_PERSIST__=true;
const KEY="ak7:cards:"+location.pathname+((location.hash||"").split("?")[0]||"");
const load=()=>{try{return JSON.parse(localStorage.getItem(KEY)||"[]")}catch(e){return[]}};
const save=a=>localStorage.setItem(KEY,JSON.stringify(a));
const add=e=>{let a=load();a.unshift(e);if(a.length>50)a=a.slice(0,50);save(a)};
function ensureWrap(){let w=document.querySelector("[data-ak7-messages],#ak7-messages");
 if(!w){w=document.createElement("div");w.setAttribute("data-ak7-messages","");
 Object.assign(w.style,{position:"fixed",right:"16px",bottom:"16px",maxWidth:"420px",zIndex:99999,display:"flex",flexDirection:"column",gap:"10px"});
 document.body.appendChild(w)}return w}
function restore(){const w=ensureWrap(),h=load();for(let i=h.length-1;i>=0;i--){const x=h[i],d=document.createElement("div");
 d.style.cssText="padding:12px;border-radius:14px;background:#fff;border:1px solid #e5e7eb;box-shadow:0 8px 24px rgba(0,0,0,.08)";
 d.innerHTML=`<div style="font-weight:600;margin-bottom:6px">${x.title}</div><pre style="margin:0;white-space:pre-wrap;font:12px/1.5 ui-monospace,Menlo,Consolas,monospace;">${x.body}</pre>`; w.prepend(d)}}
function hook(){ if(!(window.AK7&&typeof AK7.postAction==="function")){ setTimeout(hook,200); return }
 const o=AK7.postAction.bind(AK7); AK7.postAction=function(a,p){ let r=o(a,p); if(!r||typeof r.then!=="function") r=Promise.resolve(r);
 return r.then(res=>{const title=`AK7 ${a} → exitCode=${(res&&res.exitCode)||0}`, body=JSON.stringify(res||{},null,2);
 add({ts:Date.now(),title,body}); return res }).catch(err=>{const title=`AK7 ${a} → ERROR`, body=String(err&&err.stack||err);
 add({ts:Date.now(),title,body}); throw err }) } }
document.addEventListener("DOMContentLoaded",()=>{restore();hook()});
window.addEventListener("hashchange",restore);
})();
</script>
<!-- /AK7-PERSIST v1 -->
</body>
</html>




















